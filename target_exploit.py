#!/usr/bin/env python3
"""
Target Exploitation Master - Run all tools on specified target
Ø£Ø¯Ø§Ø© Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø¹Ù„Ù‰ Ù‡Ø¯Ù Ù…Ø­Ø¯Ø¯
"""

import argparse
import subprocess
import datetime
import json
import os
import time

def run_command(cmd, tool_name):
    """Run a command and return results"""
    print(f"\nğŸ¯ ØªØ´ØºÙŠÙ„: {tool_name}")
    print(f"Ø§Ù„Ø£Ù…Ø±: {cmd}")
    print("-" * 50)
    
    try:
        result = subprocess.run(cmd, shell=True, capture_output=True, text=True, timeout=300)
        success = result.returncode == 0
        print(f"âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­" if success else f"âš ï¸  ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ø¹ ØªØ­Ø°ÙŠØ±")
        return {
            "tool": tool_name,
            "command": cmd,
            "success": success,
            "return_code": result.returncode,
            "output": result.stdout[:500] if result.stdout else "",
            "error": result.stderr[:300] if result.stderr else ""
        }
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£: {str(e)}")
        return {
            "tool": tool_name,
            "command": cmd,
            "success": False,
            "error": str(e)
        }

def main():
    parser = argparse.ArgumentParser(description="Ø§Ø³ØªØºÙ„Ø§Ù„ Ù‡Ø¯Ù Ù…Ø­Ø¯Ø¯ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Øª")
    parser.add_argument("--target", "-t", required=True, help="Ø§Ù„Ù‡Ø¯Ù (IP Ø£Ùˆ Ø¯ÙˆÙ…ÙŠÙ†)")
    parser.add_argument("--output", "-o", help="Ù…Ù„Ù Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)")
    
    args = parser.parse_args()
    target = args.target
    timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    
    print(f"""
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘              Ø£Ø¯Ø§Ø© Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©                      â•‘
    â•‘                  Target: {target:<25}                     â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)
    
    results = {
        "target": target,
        "timestamp": timestamp,
        "start_time": datetime.datetime.now().isoformat(),
        "tools": []
    }
    
    # Define tools to run
    tools = [
        ("Ù…Ø§Ø³Ø­ Ø§Ù„Ø´Ø¨ÙƒØ©", f"python network_scanner.py --target {target}"),
        ("Ù…Ø§Ø³Ø­ Ø§Ù„ÙˆÙŠØ¨", f"python web_security_scanner.py --target {target}"),
        ("Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠ", f"python practical_exploitation.py --target {target} --demo all"),
        ("Ø§Ø«Ø¨Ø§Øª Ø§Ù„Ù…ÙÙ‡ÙˆÙ…", f"python poc_exploitation.py --target {target} --test all"),
        ("Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±Ø¨ÙŠ", f"python arabic_exploitation_demo.py --target {target} --demo all"),
        ("Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚", f"python penetration_testing_tool.py --target {target}"),
        ("Ø£Ø¯Ø§Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„ØµÙØ±ÙŠØ©", f"python zero_day_tool.py --demo-mode"),
        ("Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„", f"python exploitation_tools.py --demo")
    ]
    
    print(f"ğŸš€ Ø¨Ø¯Ø¡ Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ù‡Ø¯Ù: {target}")
    print(f"ğŸ“… Ø§Ù„ÙˆÙ‚Øª: {datetime.datetime.now()}")
    print(f"ğŸ› ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Øª: {len(tools)}")
    print("=" * 60)
    
    # Run all tools
    successful = 0
    for i, (tool_name, cmd) in enumerate(tools, 1):
        print(f"\nğŸ“‹ [{i}/{len(tools)}] {tool_name}")
        result = run_command(cmd, tool_name)
        results["tools"].append(result)
        if result["success"]:
            successful += 1
        time.sleep(1)
    
    # Summary
    print(f"\n{'='*60}")
    print("ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬")
    print(f"âœ… Ø§Ù„Ù†Ø§Ø¬Ø­Ø©: {successful}/{len(tools)}")
    print(f"ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: {(successful/len(tools)*100):.1f}%")
    print(f"â° Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: {datetime.datetime.now()}")
    
    # Save results
    output_file = args.output or f"target_{target.replace('.', '_').replace('://', '_')}_{timestamp}.json"
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(results, f, ensure_ascii=False, indent=2)
    
    print(f"\nğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ: {output_file}")
    
    # Generate Arabic report
    report_file = f"ØªÙ‚Ø±ÙŠØ±_Ø§Ø³ØªØºÙ„Ø§Ù„_{target.replace('.', '_').replace('://', '_')}_{timestamp}.md"
    with open(report_file, 'w', encoding='utf-8') as f:
        f.write(f"""# ØªÙ‚Ø±ÙŠØ± Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ù‡Ø¯Ù: {target}

## Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ†ÙÙŠØ°
- **Ø§Ù„Ù‡Ø¯Ù**: {target}
- **Ø§Ù„ØªØ§Ø±ÙŠØ®**: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
- **Ø§Ù„Ù†ØªØ§Ø¦Ø¬**: {output_file}

## Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø¯ÙˆØ§Øª

""")
        for tool in results["tools"]:
            status = "âœ… Ù†Ø§Ø¬Ø­" if tool["success"] else "âŒ ÙØ§Ø´Ù„"
            f.write(f"### {tool['tool']}\n")
            f.write(f"- **Ø§Ù„Ø­Ø§Ù„Ø©**: {status}\n")
            f.write(f"- **Ø§Ù„Ø£Ù…Ø±**: `{tool['command']}`\n")
            if tool.get("output"):
                f.write(f"- **Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª**: {tool['output'][:100]}...\n")
            f.write("\n")
    
    print(f"ğŸ“ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠ: {report_file}")
    print("\nğŸ‰ ØªÙ… Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ù‡Ø¯Ù Ø¨Ù†Ø¬Ø§Ø­!")

if __name__ == "__main__":
    main()